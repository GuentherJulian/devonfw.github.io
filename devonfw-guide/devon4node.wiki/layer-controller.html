<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Controller Layer</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">RESOURCES</a></p>
</li>
<li>
<p><a href="/website/pages/explore/explore.html">EXPLORE</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">DOCS</a></p>
</li>
<li>
<p><a href="/website/pages/community/community.html">COMMUNITY</a></p>
</li>
</ul>

<form class="form-inline my-2 my-lg-0">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-brand text-white mr-auto ml-3" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#layer-controller.asciidoc">Controller Layer</a>
<ul class="sectlevel1">
<li><a href="#layer-controller.asciidoc_how-to-implement-the-controller-layer">How to implement the controller layer</a></li>
<li><a href="#layer-controller.asciidoc_validation">Validation</a></li>
<li><a href="#layer-controller.asciidoc_error-handling">Error handling</a></li>
</ul>
</li>
</ul>
<h1 id="layer-controller.asciidoc" class="sect0">Controller Layer</h1>
<div class="paragraph">
<p>The controller layer is responsible for handling the requests/responses to the client. This layer knows everything about the endpoints exposed, the expected input (and also <a href="#guides-validation.asciidoc">validate</a> it), the response schema, the HTTP codes for the reponse and the HTTP errors that every endpoint can send.</p>
</div>
<div class="sect1">
<h2 id="layer-controller.asciidoc_how-to-implement-the-controller-layer">How to implement the controller layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This layer is implemented by the <a href="https://docs.nestjs.com/controllers">NestJS controllers</a>. Let&#8217;s see how it works with an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">@Controller('coffee/coffees')
export class CoffeeController {
  constructor(private readonly coffeeService: CoffeeService) {}

  @Post('search')
  @HttpCode(200)
  async searchCoffees(@Body() search: CoffeeSearch): Promise&lt;Array&lt;Coffe&gt;&gt; {
    try {
      return await this.coffeeService.searchCoffees(search);
    } catch (error) {
      throw new BadRequestException(error.message, error);
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the example, to create a controller you only need to decorate a class with the <code>Controller</code> decorator. This example is handling all request to <code>coffee/coffees</code>.</p>
</div>
<div class="paragraph">
<p>Also, you have defined one handler. This handler is listening to POST request for the route <code>coffee/coffees/search</code>. In addition, this handler is waiting for a CoffeeSearch object and returns an array of Coffee. In order to keep it simple, that&#8217;s all that you need in order to define one route.</p>
</div>
<div class="paragraph">
<p>One important thing that can be observed in this example is that there is no business logic. It delegates to the service layer and return the response to the client. At this point, transformations from the value that you receive from the service layer to the desired return type are also allowed.</p>
</div>
<div class="paragraph">
<p>By default, every POST handler return an HTTP 204 response with the returned value as body, but you can change it in a easy way by using decorators. As you can see in the example, the handler will return a HTTP 200 response (<code>@HttpCode(200)</code>).</p>
</div>
<div class="paragraph">
<p>Finally, if the service layer throws an error, this handler will catch it and return a HTTP 400 Bad Request response. The controller layer is the only one that knows about the answers to the client, therefore it is the only one that knows which error codes should be sent.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="layer-controller.asciidoc_validation">Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to do not propagate errors in the incoming payload, we need to validate all data in the controller layer. See the <a href="#guides-validation.asciidoc">validation guide</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="layer-controller.asciidoc_error-handling">Error handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous example, we catch all errors using the try/catch statement. This is not the usual implementation. In order to catch properly the errors you must use the <a href="https://docs.nestjs.com/exception-filters">exception filters</a>. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">@Controller('coffee/coffees')
export class CoffeeController {
  constructor(private readonly coffeeService: CoffeeService) {}

  @Post('search')
  @HttpCode(200)
  @UseFilters(CaffeExceptionFilter)
  async searchCoffees(@Body() search: CoffeeSearch): Promise&lt;Array&lt;Coffe&gt;&gt; {
    return await this.coffeeService.searchCoffees(search);
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#/index.html">About defonfw</a></p>
</li>
<li>
<p><a href="#/index.html">Features</a></p>
</li>
<li>
<p><a href="#/index.html">Stack technology</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#/index.html">Getting started</a></p>
</li>
<li>
<p><a href="#/index.html">Architecture</a></p>
</li>
<li>
<p><a href="#/index.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#/index.html">User guide</a></p>
</li>
<li>
<p><a href="#/index.html">Releases information</a></p>
</li>
<li>
<p><a href="#/index.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#/index.html">Contributors</a></p>
</li>
<li>
<p><a href="#/index.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="#/index.html">Terms</a></p>
</li>
<li>
<p><a href="#/index.html">Privacy</a></p>
</li>
<li>
<p><a href="#/index.html">License</a></p>
</li>
<li>
<p><a href="#/index.html">Support</a></p>
</li>
</ul>
</div>
</div>
    <script type="module">
      import { UtilsModule } from '/website/shared/utils.js';
      import { HeaderModule } from '/website/components/header/header.js';

      let searchData = { index: null, documents: null };
      UtilsModule.loadIndex(searchData);

      $(window).on('load', function() {
        const queryFun = () => {
          HeaderModule.queryFunction(searchData);
        };

        HeaderModule.searchOnClick(queryFun);
      });
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
<div class="footnote"><sub>

Last updated 2019-10-31 12:36:32 UTC
</sub></div>
</div>
</div>
</body>
</html>