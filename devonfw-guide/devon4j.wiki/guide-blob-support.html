<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>BLOB support</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<!-- ************** Google analytics ************ -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>

<!-- ******************************************** -->

</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">RESOURCES</a></p>
</li>
<li>
<p><a href="/website/pages/explore/explore.html">EXPLORE</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">DOCS</a></p>
</li>
<li>
<p><a href="/website/pages/community/community.html">COMMUNITY</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#guide-blob-support.asciidoc">BLOB support</a>
<ul class="sectlevel1">
<li><a href="#guide-blob-support.asciidoc_introduction">Introduction</a></li>
<li><a href="#guide-blob-support.asciidoc_implementing-blob-support-an-example">Implementing BLOB support: an example</a>
<ul class="sectlevel2">
<li><a href="#guide-blob-support.asciidoc_logic-layer">Logic Layer</a></li>
<li><a href="#guide-blob-support.asciidoc_service-layer">Service Layer</a></li>
</ul>
</li>
<li><a href="#guide-blob-support.asciidoc_further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
<h1 id="guide-blob-support.asciidoc" class="sect0">BLOB support</h1>
<div class="sect1">
<h2 id="guide-blob-support.asciidoc_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BLOB stands for <strong>B</strong>inary <strong>L</strong>arge <strong>Ob</strong>ject. A BLOB may be an image, an office document, ZIP archive or any other multimedia object. devon4j supports BLOB via its BinaryObject data type. The devonfw Maven archetype generates the following Java files for dealing with BLOBs:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.common.api.BinaryObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for a BinaryObject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.dataaccess.api.BinaryObjectEntity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of BinaryObject entity, contains the actual BLOB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.dataaccess.api.dao.BinaryObjectDao.java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAO for BinaryObject entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.dataaccess.base.dao.BinaryObjectDaoImpl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of the BinaryObjectDao</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.logic.api.to.BinaryObjectEto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ETO for BinaryObject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.logic.base.UcManageBinaryObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use case for managing BinaryObject. This use case contains methods for finding, getting, deleting and saving a BLOB.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.logic.impl.UCManageBinaryObjectImpl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of the UcManageBinaryObject</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="guide-blob-support.asciidoc_implementing-blob-support-an-example">Implementing BLOB support: an example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the sample application the business component Offermanagement uses BLOBs for product pictures.
Feel free to use the following approach as starting point for BLOB support in your application.</p>
</div>
<div class="sect2">
<h3 id="guide-blob-support.asciidoc_logic-layer">Logic Layer</h3>
<div class="paragraph">
<p>Use the methods declared in <code>general.logic.base.UcManageBinaryObject</code> in the implementation of your business component.
Let&#8217;s take a look at an example from the sample application.</p>
</div>
<div class="paragraph">
<p>The method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">OffermanagementImpl.updateProductPicture(Long productId, Blob blob, BinaryObjectEto binaryObjectEto)</code></pre>
</div>
</div>
<div class="paragraph">
<p>saves a new picture for a given product.</p>
</div>
<div class="paragraph">
<p>This is done by calling an appropriate method, declared in the BinaryObject use case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Override
@RolesAllowed(PermissionConstants.SAVE_PRODUCT_PICTURE)
public void updateProductPicture(Long productId, Blob blob, BinaryObjectEto binaryObjectEto) {

    ...
      binaryObjectEto = getUcManageBinaryObject().saveBinaryObject(blob, binaryObjectEto);
    ...
 }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-blob-support.asciidoc_service-layer">Service Layer</h3>
<div class="paragraph">
<p>Following the devonfw conventions, you must implement a REST service for each business component. There you define, how BLOBs are uploaded/downloaded. According to that, the REST service for the business component Offermanagement is implemented in a class named OffermanagementRestServiceImpl.</p>
</div>
<div class="paragraph">
<p>The coding examples below are taken from the afore mentioned class.</p>
</div>
<div class="paragraph">
<p>The sample application uses the content-type "multipart/mixed" to transfer pictures plus additional header data.</p>
</div>
<div class="paragraph">
<p><strong>Upload</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Consumes("multipart/mixed")
@POST
@Path("/product/{id}/picture")
  public void updateProductPicture(@PathParam("id") long productId,
      @Multipart(value = "binaryObjectEto", type = MediaType.APPLICATION_JSON) BinaryObjectEto binaryObjectEto,
      @Multipart(value = "blob", type = MediaType.APPLICATION_OCTET_STREAM) InputStream picture)
      throws SerialException, SQLException, IOException {

    Blob blob = new SerialBlob(IOUtils.readBytesFromStream(picture));
    this.offerManagement.updateProductPicture(productId, blob, binaryObjectEto);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A new Blob object is being created by reading the data (<code>IOUtils.readBytesFromStream(picture)</code>).</p>
</div>
<div class="paragraph">
<p><strong>Download</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Produces("multipart/mixed")
@GET
@Path("/product/{id}/picture")
public MultipartBody getProductPicture(@PathParam("id") long productId) throws SQLException, IOException {

    Blob blob = this.offerManagement.findProductPictureBlob(productId);
    byte[] data = IOUtils.readBytesFromStream(blob.getBinaryStream());

    List&lt;Attachment&gt; atts = new LinkedList&lt;&gt;();
    atts.add(new Attachment("binaryObjectEto", MediaType.APPLICATION_JSON, this.offerManagement
        .findProductPicture(productId)));
    atts.add(new Attachment("blob", MediaType.APPLICATION_OCTET_STREAM, new ByteArrayInputStream(data)));
    return new MultipartBody(atts, true);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you may have noticed, the data is loaded into the heap before it is added as an Attachement to the MultiPart body.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Caution!</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using a byte array will cause problems, when dealing with large BLOBs.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Why is the sample application using a byte array then?</strong></p>
</div>
<div class="paragraph">
<p>As of now, there is no universal solid way of streaming a BLOB directly from a database to the client without reading the BLOB’s content to memory, when streaming over a RESTful service based on JDBC and JAX RS.
Following this approach means:  whenever a file is uploaded or downloaded as BLOB it is loaded completely to memory before it is written to the database.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-blob-support.asciidoc_further-reading">Further Reading</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="http://www.w3.org/Protocols/rfc1341/7_2_Multipart.html">The multipart content type</a></p>
</li>
<li>
<p><a href="http://cxf.apache.org/docs/jax-rs-multiparts.html">JAX-RS : Support for Multiparts</a></p>
</li>
<li>
<p><a href="guide-logic-layer.html#component-implementation">Component Implementation</a></p>
</li>
<li>
<p><a href="guide-jpa.html#blob">BLOBs and the Data Access Layer</a></p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Unrestricted_File_Upload">Security Vulnerability Unrestricted File Upload</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started-what-is-devonfw.asciidoc.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started-why-should-i-use-devonfw.asciidoc.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started-what-is-devonfw.asciidoc.html#getting-started-what-is-devonfw.asciidoc_devonfw-technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/master-general-start.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-devon4j.asciidoc_introduction.html#architecture.asciidoc">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/master-ide.asciidoc_integrated-development-environment.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/general-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="#/index.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script type="module">
      import { UtilsModule } from '/website/shared/utils.js';
      import { HeaderModule } from '/website/components/header/header.js';

      let searchData = { index: null, documents: null };
      UtilsModule.loadIndex(searchData);

      $(window).on('load', function() {
        const queryFun = () => {
          HeaderModule.queryFunction(searchData);
        };

        HeaderModule.searchOnClick(queryFun);
      });
    </script>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
<div class="footnote"><sub>

Last updated 2020-01-24 16:41:53 UTC
</sub></div>
</div>
</div>
</body>
</html>